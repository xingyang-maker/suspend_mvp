<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suspend Diagnosis Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1a202c;
            border-bottom: 3px solid #3182ce;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }
        
        h2 {
            color: #2d3748;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 6px;
            font-size: 1.5rem;
        }
        
        h3 {
            color: #4a5568;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }
        
        hr {
            border: none;
            border-top: 2px solid #e2e8f0;
            margin: 2rem 0;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        strong {
            color: #2d3748;
            font-weight: 600;
        }
        
        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        
        li {
            margin-bottom: 0.5rem;
        }
        
        code {
            background: #f7fafc;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #e53e3e;
        }
        
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1.5rem;
            background: white;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: left;
        }
        
        th {
            background: #edf2f7;
            font-weight: 600;
            color: #2d3748;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .status-success {
            color: #38a169;
            font-weight: bold;
        }
        
        .status-failure {
            color: #e53e3e;
            font-weight: bold;
        }
        
        .section-card {
            background: #f7fafc;
            border-left: 4px solid #3182ce;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .finding-item {
            background: #fff5f5;
            border-left: 3px solid #fc8181;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 3px;
        }
        
        .finding-item.normal {
            background: #f0fff4;
            border-left-color: #68d391;
        }
        
        .ai-section {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .checklist {
            background: #fffaf0;
            border: 2px solid #ed8936;
            padding: 1.5rem;
            border-radius: 8px;
        }
        
        .checklist li {
            padding: 0.5rem 0;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
<h1>Suspend Diagnosis Report</h1>
<p><strong>Collection Directory</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\blocked_bywakelock</code><br />
<strong>Time</strong>: 2025-11-23T17:32:17.846676</p>
<hr />
<h2>üî¥ CONCLUSION: Suspend Failure Detected</h2>
<p><strong>Root Cause</strong>: Root cause: Active wakelocks preventing suspend: PowerManagerService.Display, PowerManager.SuspendLockout, a600000.hsusb</p>
<hr />
<h2>Step 2Ô∏è‚É£: Wakelock Analysis</h2>
<p><strong>Purpose</strong>: Check for active wakelocks preventing suspend<br />
<strong>File</strong>: <code>dumpsys suspend_control_internal</code> ‚Üí <code>dumpsys_suspend.txt</code></p>
<p>‚ùå <strong>Result</strong>: Active wakelocks found (ROOT CAUSE)
<strong>Active Wakelocks</strong>:
- <code>PowerManagerService.Display</code>
- <code>PowerManager.SuspendLockout</code>
- <code>a600000.hsusb</code></p>
<p><strong>Analysis stops here</strong> - Root cause identified</p>
<h3>ÂéüÂßã Wakelock Dump (ÂÖ≥ÈîÆÁâáÊÆµ)</h3>
<pre><code class="language-text"> |                                                                                           WAKELOCK STATS                                                                                        | 
 | NAME                           | PID    | TYPE   | STATUS   | ACTIVE COUNT | TOTAL TIME   | MAX TIME     | EVENT COUNT  | WAKEUP COUNT | EXPIRE COUNT | PREVENT SUSPEND TIME | LAST CHANGE      | 
 | PowerManagerService.WakeLocks  |   1922 | Native | Inactive |            0 |      13204ms |       6497ms |          --- |          --- |          --- |                  --- |        1091401ms | 
 | PowerManagerService.Broadcasts |   1922 | Native | Inactive |            0 |        168ms |        141ms |          --- |          --- |          --- |                  --- |         810554ms | 
 | PowerManagerService.Display    |   1922 | Native | Active   |            1 |     941874ms |     653247ms |          --- |          --- |          --- |                  --- |        1099043ms | 
 | PowerManager.SuspendLockout    |   1922 | Native | Active   |            1 |     941839ms |     653211ms |          --- |          --- |          --- |                  --- |        1099043ms | 
 | radio-interface                |   1263 | Native | Inactive |            0 |        227ms |        217ms |          --- |          --- |          --- |                  --- |         140169ms | 
 | ApmOutput                      |   2453 | Native | Inactive |            0 |       1023ms |         44ms |          --- |          --- |          --- |                  --- |         137884ms | 
 | PowerManagerService.Booting    |   1922 | Native | Inactive |            0 |      52860ms |      52860ms |          --- |          --- |          --- |                  --- |         137126ms | 
 | qms_event_Handler_wakeLock_    |   1413 | Native | Inactive |            0 |        607ms |        445ms |          --- |          --- |          --- |                  --- |         124920ms | 
 | ApmAudio                       |   2453 | Native | Inactive |            0 |        498ms |         88ms |          --- |          --- |          --- |                  --- |         102870ms | 
 | ApmOutput                      |   1209 | Native | Inactive |            0 |         10ms |          4ms |          --- |          --- |          --- |                  --- |          89723ms | 
 | ApmAudio                       |   1209 | Native | Inactive |            0 |        222ms |         71ms |          --- |          --- |          --- |                  --- |          89717ms | 
 | qcril_pre_client_init          |   1263 | Native | Inactive |            0 |       1388ms |       1388ms |          --- |          --- |          --- |                  --- |          78474ms | 
 | event3                         |    --- | Kernel | Inactive |            4 |          3ms |          1ms |            4 |            0 |            0 |                  0ms |         810533ms | 
 | [timerfd]                      |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | c42d000.qcom,spmi:pmw6100@0:pon_hlos@1300:pwrkey |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | usb                            |    --- | Kernel | Inactive |            2 |        144ms |         98ms |            2 |            0 |            0 |                  0ms |          78847ms | 
 | fastrpc-non_secure             |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | rmt_storage_541074766912       |    --- | Kernel | Inactive |            2 |         78ms |         75ms |            2 |            0 |            0 |                  0ms |         167621ms | 
... (truncated)
</code></pre>
<hr />
<h2>üìã ÊÄªÁªì</h2>
<p><strong>ÁªìËÆ∫</strong>: Root cause: Active wakelocks preventing suspend: PowerManagerService.Display, PowerManager.SuspendLockout, a600000.hsusb</p>
<hr />
<h2>ü§ñ AI Comprehensive Analysis</h2>
<h2>Suspend Status</h2>
<ul>
<li><strong>/d/suspend_stats</strong> ‚Äì No data was provided (empty).  </li>
<li><strong>dumpsys suspend_control_internal</strong> ‚Äì The ‚ÄúSuspend Stats‚Äù section shows <strong><code>success: 0</code></strong>, <strong><code>fail: 0</code></strong>, and <strong><code>suspend attempts: 0</code></strong>.  </li>
<li><strong>Interpretation:</strong> The device has <strong>never successfully entered suspend</strong> since the last boot. No suspend attempts have been recorded, indicating that something is actively preventing the system from reaching the suspend state.</li>
</ul>
<hr />
<h2>Wakelock Analysis</h2>
<table>
<thead>
<tr>
<th>Type</th>
<th>Name / Description</th>
<th>PID</th>
<th>Status</th>
<th>Active Since</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PowerManager (Native)</strong></td>
<td><code>PowerManager.Service.Display</code></td>
<td>1922</td>
<td><strong>Active</strong></td>
<td>~1‚ÄØ090‚ÄØ043‚ÄØms ago</td>
</tr>
<tr>
<td><strong>PowerManager (Native)</strong></td>
<td><code>PowerManager.SuspendLockout</code></td>
<td>1922</td>
<td><strong>Active</strong></td>
<td>~1‚ÄØ090‚ÄØ043‚ÄØms ago</td>
</tr>
<tr>
<td><strong>Kernel</strong></td>
<td><code>a600000.hsusb</code> (USB HSUSB controller)</td>
<td>‚Äî</td>
<td><strong>Active</strong></td>
<td>~80‚ÄØ272‚ÄØms ago</td>
</tr>
</tbody>
</table>
<p>All other wakelocks listed are <strong>Inactive</strong>.<br />
The two active <strong>PowerManager</strong> wakelocks (<code>Display</code> and <code>SuspendLockout</code>) together with the active <strong>USB</strong> kernel wakelock are the <strong>only blockers</strong> that are keeping the system from suspending.</p>
<p><code>last_failed_suspend</code> counters are <strong>zero</strong>, confirming that the suspend path never even started because the system was already considered ‚Äúbusy‚Äù by the active wakelocks.</p>
<hr />
<h2>Root Cause (if applicable)</h2>
<p><strong>Not applicable</strong> ‚Äì suspend failures are not due to kernel errors or driver problems; they are being prevented by active wakelocks.</p>
<hr />
<h2>Recommendations</h2>
<ol>
<li><strong>Identify the source of the <code>Display</code> wakelock</strong>  </li>
<li>This wakelock is held by the system UI when the screen is on.  </li>
<li>Ensure the display is turned <strong>off</strong> (press the power button or let the screen timeout expire).  </li>
<li>
<p>If the screen stays on indefinitely, look for an app that is forcing the screen to stay awake (e.g., ‚ÄúStay awake while charging‚Äù, developer options, video playback, navigation apps, or a misbehaving foreground service).</p>
</li>
<li>
<p><strong>Investigate the <code>SuspendLockout</code> wakelock</strong>  </p>
</li>
<li><code>SuspendLockout</code> is a system‚Äëlevel lock that the framework sets when a component explicitly asks the system not to suspend (often during critical operations like OTA updates, camera usage, or heavy I/O).  </li>
<li>Check recent logs (<code>logcat -b all -d | grep -i suspendlockout</code>) to see which process requested it.  </li>
<li>
<p>If it is held for an unusually long time, consider rebooting the device or stopping the offending service/app.</p>
</li>
<li>
<p><strong>Address the active USB wakelock (<code>a600000.hsusb</code>)</strong>  </p>
</li>
<li>The USB controller stays awake when a USB device is connected or when USB debugging is active.  </li>
<li><strong>Disconnect any USB cable</strong> (including chargers that expose data lines) and verify that the wakelock disappears.  </li>
<li>
<p>If you need the device plugged in, enable <strong>‚ÄúUSB charging only‚Äù</strong> mode (disable file transfer, tethering, or debugging) to allow the USB subsystem to release the lock.</p>
</li>
<li>
<p><strong>General steps to force a clean suspend</strong>  </p>
</li>
<li><strong>Reboot</strong> the device after clearing the above conditions; this resets any lingering wakelocks.<br />
<strong>or</strong>  </li>
<li>
<p>Use <code>adb shell dumpsys power</code> to manually release a wakelock (e.g., <code>adb shell dumpsys power release [wakelock_name]</code>) <strong>only if you are certain the lock is not needed</strong>.</p>
</li>
<li>
<p><strong>Monitor after changes</strong>  </p>
</li>
<li>Run <code>adb shell dumpsys suspend_control_internal</code> again.  </li>
<li>You should see <code>success</code> increment and <code>suspend attempts</code> &gt;‚ÄØ0, with no active PowerManager wakelocks.  </li>
<li>Verify that <code>/d/suspend_stats</code> now shows non‚Äëzero success counts.</li>
</ol>
<p>By clearing the active display, suspend‚Äëlockout, and USB wakelocks, the system will be able to enter deep suspend, and the suspend statistics will start reflecting successful suspend cycles. If after all of the above the device still never attempts suspend, revisit the kernel logs (<code>dmesg</code>) for hidden driver errors, but the current data points clearly to wakelock‚Äëbased blockage.</p>
<hr />
<h2>üìÅ Evidence Files</h2>
<ul>
<li><strong>dumpsys_suspend.txt</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\blocked_bywakelock\dumpsys_suspend.txt</code></li>
</ul>
<hr />
<h2>‚úÖ Verification Checklist</h2>
<p>After fixing the identified issue:</p>
<ol>
<li><strong>Re-run diagnosis</strong>: Collect new evidence and verify the issue is resolved</li>
<li><strong>Check suspend_stats</strong>: Verify success count increases and fail count remains 0</li>
<li><strong>Check wakelocks</strong>: Ensure no active wakelocks in dumpsys output</li>
<li><strong>Measure power</strong>: Compare power consumption before/after fix (expect ‚â•3% reduction)</li>
</ol>
    </div>
</body>
</html>