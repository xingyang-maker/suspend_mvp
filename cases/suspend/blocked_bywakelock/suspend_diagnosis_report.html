<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suspend Diagnosis Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1a202c;
            border-bottom: 3px solid #3182ce;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }
        
        h2 {
            color: #2d3748;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 6px;
            font-size: 1.5rem;
        }
        
        h3 {
            color: #4a5568;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }
        
        hr {
            border: none;
            border-top: 2px solid #e2e8f0;
            margin: 2rem 0;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        strong {
            color: #2d3748;
            font-weight: 600;
        }
        
        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        
        li {
            margin-bottom: 0.5rem;
        }
        
        code {
            background: #f7fafc;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #e53e3e;
        }
        
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1.5rem;
            background: white;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: left;
        }
        
        th {
            background: #edf2f7;
            font-weight: 600;
            color: #2d3748;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .status-success {
            color: #38a169;
            font-weight: bold;
        }
        
        .status-failure {
            color: #e53e3e;
            font-weight: bold;
        }
        
        .section-card {
            background: #f7fafc;
            border-left: 4px solid #3182ce;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .finding-item {
            background: #fff5f5;
            border-left: 3px solid #fc8181;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 3px;
        }
        
        .finding-item.normal {
            background: #f0fff4;
            border-left-color: #68d391;
        }
        
        .ai-section {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .checklist {
            background: #fffaf0;
            border: 2px solid #ed8936;
            padding: 1.5rem;
            border-radius: 8px;
        }
        
        .checklist li {
            padding: 0.5rem 0;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
<h1>Suspend Diagnosis Report</h1>
<p><strong>Collection Directory</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\suspend\blocked_bywakelock</code><br />
<strong>Time</strong>: 2025-11-23T17:48:26.691555</p>
<hr />
<h2>üî¥ CONCLUSION: Suspend Failure Detected</h2>
<p><strong>Root Cause</strong>: Root cause: Active wakelocks preventing suspend: PowerManagerService.Display, PowerManager.SuspendLockout, a600000.hsusb</p>
<hr />
<h2>Step 2Ô∏è‚É£: Wakelock Analysis</h2>
<p><strong>Purpose</strong>: Check for active wakelocks preventing suspend<br />
<strong>File</strong>: <code>dumpsys suspend_control_internal</code> ‚Üí <code>dumpsys_suspend.txt</code></p>
<p>‚ùå <strong>Result</strong>: Active wakelocks found (ROOT CAUSE)
<strong>Active Wakelocks</strong>:
- <code>PowerManagerService.Display</code>
- <code>PowerManager.SuspendLockout</code>
- <code>a600000.hsusb</code></p>
<p><strong>Analysis stops here</strong> - Root cause identified</p>
<h3>ÂéüÂßã Wakelock Dump (ÂÖ≥ÈîÆÁâáÊÆµ)</h3>
<pre><code class="language-text"> |                                                                                           WAKELOCK STATS                                                                                        | 
 | NAME                           | PID    | TYPE   | STATUS   | ACTIVE COUNT | TOTAL TIME   | MAX TIME     | EVENT COUNT  | WAKEUP COUNT | EXPIRE COUNT | PREVENT SUSPEND TIME | LAST CHANGE      | 
 | PowerManagerService.WakeLocks  |   1922 | Native | Inactive |            0 |      13204ms |       6497ms |          --- |          --- |          --- |                  --- |        1091401ms | 
 | PowerManagerService.Broadcasts |   1922 | Native | Inactive |            0 |        168ms |        141ms |          --- |          --- |          --- |                  --- |         810554ms | 
 | PowerManagerService.Display    |   1922 | Native | Active   |            1 |     941874ms |     653247ms |          --- |          --- |          --- |                  --- |        1099043ms | 
 | PowerManager.SuspendLockout    |   1922 | Native | Active   |            1 |     941839ms |     653211ms |          --- |          --- |          --- |                  --- |        1099043ms | 
 | radio-interface                |   1263 | Native | Inactive |            0 |        227ms |        217ms |          --- |          --- |          --- |                  --- |         140169ms | 
 | ApmOutput                      |   2453 | Native | Inactive |            0 |       1023ms |         44ms |          --- |          --- |          --- |                  --- |         137884ms | 
 | PowerManagerService.Booting    |   1922 | Native | Inactive |            0 |      52860ms |      52860ms |          --- |          --- |          --- |                  --- |         137126ms | 
 | qms_event_Handler_wakeLock_    |   1413 | Native | Inactive |            0 |        607ms |        445ms |          --- |          --- |          --- |                  --- |         124920ms | 
 | ApmAudio                       |   2453 | Native | Inactive |            0 |        498ms |         88ms |          --- |          --- |          --- |                  --- |         102870ms | 
 | ApmOutput                      |   1209 | Native | Inactive |            0 |         10ms |          4ms |          --- |          --- |          --- |                  --- |          89723ms | 
 | ApmAudio                       |   1209 | Native | Inactive |            0 |        222ms |         71ms |          --- |          --- |          --- |                  --- |          89717ms | 
 | qcril_pre_client_init          |   1263 | Native | Inactive |            0 |       1388ms |       1388ms |          --- |          --- |          --- |                  --- |          78474ms | 
 | event3                         |    --- | Kernel | Inactive |            4 |          3ms |          1ms |            4 |            0 |            0 |                  0ms |         810533ms | 
 | [timerfd]                      |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | c42d000.qcom,spmi:pmw6100@0:pon_hlos@1300:pwrkey |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | usb                            |    --- | Kernel | Inactive |            2 |        144ms |         98ms |            2 |            0 |            0 |                  0ms |          78847ms | 
 | fastrpc-non_secure             |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | rmt_storage_541074766912       |    --- | Kernel | Inactive |            2 |         78ms |         75ms |            2 |            0 |            0 |                  0ms |         167621ms | 
... (truncated)
</code></pre>
<hr />
<h2>üìã ÊÄªÁªì</h2>
<p><strong>ÁªìËÆ∫</strong>: Root cause: Active wakelocks preventing suspend: PowerManagerService.Display, PowerManager.SuspendLockout, a600000.hsusb</p>
<hr />
<h2>ü§ñ AI Comprehensive Analysis</h2>
<p><strong>## Suspend Status</strong><br />
- <code>/d/suspend_stats</code> is empty, so no kernel‚Äëlevel statistics are available.<br />
- The <code>dumpsys suspend_control_internal</code> section shows <strong>no suspend attempts</strong> have been recorded (<code>suspend attempts: 0</code>).<br />
- All counters for successes/failures are <strong>0</strong> (<code>success: 0</code>, <code>fail: 0</code>).<br />
- <strong>Conclusion:</strong> The device is <strong>not entering suspend at all</strong>.</p>
<hr />
<p><strong>## Wakelock Analysis</strong><br />
The wakelock table from <code>dumpsys suspend_control_internal</code> reveals several <strong>active</strong> locks that are currently preventing suspend:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Status</th>
<th>Active Count</th>
<th>Total Time</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PowerManager.Service.Display</strong></td>
<td>Native</td>
<td><strong>Active</strong></td>
<td>1</td>
<td>941‚ÄØ874‚ÄØms</td>
</tr>
<tr>
<td><strong>PowerManager.SuspendLockout</strong></td>
<td>Native</td>
<td><strong>Active</strong></td>
<td>1</td>
<td>941‚ÄØ839‚ÄØms</td>
</tr>
<tr>
<td><strong>a600000.hsusb</strong> (USB)</td>
<td>Kernel</td>
<td><strong>Active</strong></td>
<td>1</td>
<td>1‚ÄØ018‚ÄØ798‚ÄØms</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Display wakelock</strong> ‚Äì the screen is on (or a ‚Äústay‚Äëawake while charging‚Äù setting is enabled).  </li>
<li><strong>SuspendLockout</strong> ‚Äì a system‚Äëlevel lock that deliberately blocks suspend (often set by a developer option, a debugging tool, or a misbehaving app).  </li>
<li><strong>USB (hsusb) wakelock</strong> ‚Äì a USB‚Äërelated wake lock, typically held while a USB cable is attached, USB debugging is active, or a peripheral driver is busy.</li>
</ul>
<p>No other wakelocks are active; the rest are <strong>Inactive</strong>.</p>
<p>Because active wakelocks are present, the system cannot proceed to suspend, which explains the zero suspend attempts.</p>
<hr />
<p><strong>## Root Cause (not applicable)</strong><br />
A root‚Äëcause analysis of <code>dmesg</code> is <strong>not required</strong> here because suspend failures are directly attributable to active wakelocks.</p>
<hr />
<p><strong>## Recommendations</strong></p>
<ol>
<li><strong>Turn off the display / disable ‚ÄúStay awake‚Äù</strong></li>
<li>Settings ‚Üí Developer options ‚Üí <strong>Stay awake (Screen will never sleep while charging)</strong> ‚Äì make sure this is <strong>unchecked</strong>.</li>
<li>
<p>Manually turn off the screen or let it time‚Äëout.</p>
</li>
<li>
<p><strong>Identify and clear the <code>PowerManager.SuspendLockout</code></strong></p>
</li>
<li>This lock is usually set by:<ul>
<li><strong>Developer options</strong> ‚Äì ‚ÄúEnable wake‚Äëlock debugging‚Äù or ‚ÄúForce keep‚Äëawake‚Äù.</li>
<li><strong>Battery‚Äëoptimisation</strong> tools or third‚Äëparty apps that request a suspend lock.</li>
</ul>
</li>
<li>
<p>Steps:</p>
<ol>
<li>Re‚Äëboot the device into <strong>Safe Mode</strong> (press power button, then long‚Äëpress ‚ÄúPower off‚Äù ‚Üí ‚ÄúReboot to safe mode‚Äù).  <ul>
<li>If the lock disappears, a third‚Äëparty app is responsible; uninstall or update the offending app.  </li>
</ul>
</li>
<li>If it persists, clear it via <strong>adb</strong> (requires root or appropriate permissions):
    <code>bash
    adb shell dumpsys power | grep SuspendLockout
    # To release (if you have permission):
    adb shell su -c "echo 0 &gt; /sys/power/wakeup_count"</code></li>
<li>Check for any <strong>system services</strong> that may have called <code>PowerManager.acquireSuspendLock()</code> (e.g., certain OEM power‚Äësaving or performance‚Äëtuning apps). Disable or update them.</li>
</ol>
</li>
<li>
<p><strong>Clear the USB wake lock</strong></p>
</li>
<li>Disconnect any USB cable or peripheral.</li>
<li>Disable <strong>USB debugging</strong> (Settings ‚Üí Developer options ‚Üí USB debugging) if not needed.</li>
<li>
<p>If the lock remains while the cable is unplugged, a driver may be stuck; a quick reboot usually clears it.</p>
</li>
<li>
<p><strong>Verify with <code>dumpsys</code> after changes</strong></p>
</li>
<li>Run:
     <code>bash
     adb shell dumpsys suspend_control_internal</code></li>
<li>
<p>Ensure <strong>no active wakelocks</strong> remain (all entries should show <code>Inactive</code>).</p>
</li>
<li>
<p><strong>Test suspend functionality</strong></p>
</li>
<li>Force a suspend manually:
     <code>bash
     adb shell echo mem &gt; /sys/power/state</code></li>
<li>
<p>If the device enters suspend (screen turns off, no wake‚Äëup for a few seconds), the issue is resolved.</p>
</li>
<li>
<p><strong>Monitor for recurrence</strong></p>
</li>
<li>Keep an eye on <code>/d/suspend_stats</code> (or <code>cat /sys/kernel/debug/power/suspend_stats</code> on newer kernels) to confirm that suspend attempts and successes start occurring after the fixes.</li>
</ol>
<p>By clearing the active display, suspend‚Äëlockout, and USB wake locks, the system should be able to enter suspend normally, and the suspend statistics will begin to show successful suspend cycles.</p>
<hr />
<h2>üìÅ Evidence Files</h2>
<ul>
<li><strong>dumpsys_suspend.txt</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\suspend\blocked_bywakelock\dumpsys_suspend.txt</code></li>
</ul>
<hr />
<h2>‚úÖ Verification Checklist</h2>
<p>After fixing the identified issue:</p>
<ol>
<li><strong>Re-run diagnosis</strong>: Collect new evidence and verify the issue is resolved</li>
<li><strong>Check suspend_stats</strong>: Verify success count increases and fail count remains 0</li>
<li><strong>Check wakelocks</strong>: Ensure no active wakelocks in dumpsys output</li>
<li><strong>Measure power</strong>: Compare power consumption before/after fix (expect ‚â•3% reduction)</li>
</ol>
    </div>
</body>
</html>