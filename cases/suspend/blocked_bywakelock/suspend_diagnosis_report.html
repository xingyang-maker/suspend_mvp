<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suspend Diagnosis Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1a202c;
            border-bottom: 3px solid #3182ce;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }
        
        h2 {
            color: #2d3748;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 6px;
            font-size: 1.5rem;
        }
        
        h3 {
            color: #4a5568;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }
        
        hr {
            border: none;
            border-top: 2px solid #e2e8f0;
            margin: 2rem 0;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        strong {
            color: #2d3748;
            font-weight: 600;
        }
        
        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        
        li {
            margin-bottom: 0.5rem;
        }
        
        code {
            background: #f7fafc;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #e53e3e;
        }
        
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1.5rem;
            background: white;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: left;
        }
        
        th {
            background: #edf2f7;
            font-weight: 600;
            color: #2d3748;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .status-success {
            color: #38a169;
            font-weight: bold;
        }
        
        .status-failure {
            color: #e53e3e;
            font-weight: bold;
        }
        
        .section-card {
            background: #f7fafc;
            border-left: 4px solid #3182ce;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .finding-item {
            background: #fff5f5;
            border-left: 3px solid #fc8181;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 3px;
        }
        
        .finding-item.normal {
            background: #f0fff4;
            border-left-color: #68d391;
        }
        
        .ai-section {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .checklist {
            background: #fffaf0;
            border: 2px solid #ed8936;
            padding: 1.5rem;
            border-radius: 8px;
        }
        
        .checklist li {
            padding: 0.5rem 0;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
<h1>Suspend Diagnosis Report</h1>
<p><strong>Collection Directory</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\suspend\blocked_bywakelock</code><br />
<strong>Time</strong>: 2025-11-23T18:08:05.099498</p>
<hr />
<h2>üî¥ CONCLUSION: Suspend Failure Detected</h2>
<p><strong>Root Cause</strong>: Root cause: Active wakelocks preventing suspend: PowerManagerService.Display, PowerManager.SuspendLockout, a600000.hsusb</p>
<hr />
<h2>Step 2Ô∏è‚É£: Wakelock Analysis</h2>
<p><strong>Purpose</strong>: Check for active wakelocks preventing suspend<br />
<strong>File</strong>: <code>dumpsys suspend_control_internal</code> ‚Üí <code>dumpsys_suspend.txt</code></p>
<p>‚ùå <strong>Result</strong>: Active wakelocks found (ROOT CAUSE)
<strong>Active Wakelocks</strong>:
- <code>PowerManagerService.Display</code>
- <code>PowerManager.SuspendLockout</code>
- <code>a600000.hsusb</code></p>
<p><strong>Analysis stops here</strong> - Root cause identified</p>
<h3>ÂéüÂßã Wakelock Dump (ÂÖ≥ÈîÆÁâáÊÆµ)</h3>
<pre><code class="language-text"> |                                                                                           WAKELOCK STATS                                                                                        | 
 | NAME                           | PID    | TYPE   | STATUS   | ACTIVE COUNT | TOTAL TIME   | MAX TIME     | EVENT COUNT  | WAKEUP COUNT | EXPIRE COUNT | PREVENT SUSPEND TIME | LAST CHANGE      | 
 | PowerManagerService.WakeLocks  |   1922 | Native | Inactive |            0 |      13204ms |       6497ms |          --- |          --- |          --- |                  --- |        1091401ms | 
 | PowerManagerService.Broadcasts |   1922 | Native | Inactive |            0 |        168ms |        141ms |          --- |          --- |          --- |                  --- |         810554ms | 
 | PowerManagerService.Display    |   1922 | Native | Active   |            1 |     941874ms |     653247ms |          --- |          --- |          --- |                  --- |        1099043ms | 
 | PowerManager.SuspendLockout    |   1922 | Native | Active   |            1 |     941839ms |     653211ms |          --- |          --- |          --- |                  --- |        1099043ms | 
 | radio-interface                |   1263 | Native | Inactive |            0 |        227ms |        217ms |          --- |          --- |          --- |                  --- |         140169ms | 
 | ApmOutput                      |   2453 | Native | Inactive |            0 |       1023ms |         44ms |          --- |          --- |          --- |                  --- |         137884ms | 
 | PowerManagerService.Booting    |   1922 | Native | Inactive |            0 |      52860ms |      52860ms |          --- |          --- |          --- |                  --- |         137126ms | 
 | qms_event_Handler_wakeLock_    |   1413 | Native | Inactive |            0 |        607ms |        445ms |          --- |          --- |          --- |                  --- |         124920ms | 
 | ApmAudio                       |   2453 | Native | Inactive |            0 |        498ms |         88ms |          --- |          --- |          --- |                  --- |         102870ms | 
 | ApmOutput                      |   1209 | Native | Inactive |            0 |         10ms |          4ms |          --- |          --- |          --- |                  --- |          89723ms | 
 | ApmAudio                       |   1209 | Native | Inactive |            0 |        222ms |         71ms |          --- |          --- |          --- |                  --- |          89717ms | 
 | qcril_pre_client_init          |   1263 | Native | Inactive |            0 |       1388ms |       1388ms |          --- |          --- |          --- |                  --- |          78474ms | 
 | event3                         |    --- | Kernel | Inactive |            4 |          3ms |          1ms |            4 |            0 |            0 |                  0ms |         810533ms | 
 | [timerfd]                      |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | c42d000.qcom,spmi:pmw6100@0:pon_hlos@1300:pwrkey |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | usb                            |    --- | Kernel | Inactive |            2 |        144ms |         98ms |            2 |            0 |            0 |                  0ms |          78847ms | 
 | fastrpc-non_secure             |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | rmt_storage_541074766912       |    --- | Kernel | Inactive |            2 |         78ms |         75ms |            2 |            0 |            0 |                  0ms |         167621ms | 
... (truncated)
</code></pre>
<hr />
<h2>üìã ÊÄªÁªì</h2>
<p><strong>ÁªìËÆ∫</strong>: Root cause: Active wakelocks preventing suspend: PowerManagerService.Display, PowerManager.SuspendLockout, a600000.hsusb</p>
<hr />
<h2>ü§ñ AI Comprehensive Analysis</h2>
<h2>Suspend Status</h2>
<p><strong>Result:</strong>‚ÄØSuspend has never been attempted.  </p>
<ul>
<li><code>success: 0</code>  </li>
<li><code>fail: 0</code>  </li>
<li><code>suspend attempts: 0</code>  </li>
</ul>
<p>The kernel reports <strong>zero suspend attempts</strong> and <strong>zero successful suspends</strong>, which means the system never entered a low‚Äëpower state.</p>
<hr />
<h2>Wakelock Analysis</h2>
<p><strong>Active wakelocks that block suspend</strong></p>
<table>
<thead>
<tr>
<th>Name (type)</th>
<th>PID</th>
<th>Status</th>
<th>Active time</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PowerManager.Service.Display</strong></td>
<td>1922</td>
<td><strong>Active</strong></td>
<td>‚ÄØ‚âà‚ÄØ941‚ÄØs (‚âà‚ÄØ15‚ÄØmin)</td>
</tr>
<tr>
<td><strong>PowerManager.SuspendLockout</strong></td>
<td>1922</td>
<td><strong>Active</strong></td>
<td>‚ÄØ‚âà‚ÄØ941‚ÄØs (‚âà‚ÄØ15‚ÄØmin)</td>
</tr>
</tbody>
</table>
<p>Both of the above are <strong>native</strong> wakelocks held by the system process (<code>pid 1922</code>).  </p>
<ul>
<li><code>PowerManager.Service.Display</code> is the classic ‚Äúscreen‚Äëon‚Äù wakelock ‚Äì the display is on, so the device is not allowed to suspend.  </li>
<li><code>PowerManager.SuspendLockout</code> is a special lock that deliberately prevents suspend (e.g., ‚ÄúStay awake while charging‚Äù, developer‚Äëoption ‚ÄúStay awake‚Äù, or a bugged system component).  </li>
</ul>
<p>All other wakelocks are <strong>inactive</strong>; no third‚Äëparty app is holding a lock.</p>
<p><strong>Conclusion:</strong> The active <strong>Display</strong> and <strong>SuspendLockout</strong> wakelocks are the direct reason why the kernel never attempts to suspend.</p>
<hr />
<h2>Root Cause (if applicable)</h2>
<p><em>Not applicable</em> ‚Äì suspend failure is fully explained by the active wakelocks. No kernel‚Äëlevel errors are present in <code>dmesg</code> (the log is empty), and <code>/d/suspend_stats</code> shows no failure counters.</p>
<hr />
<h2>Recommendations</h2>
<ol>
<li><strong>Turn off the display / let the screen sleep</strong>  </li>
<li>Manually press the power button or set a shorter screen‚Äëtimeout (<code>Settings ‚Üí Display ‚Üí Sleep</code>).  </li>
<li>
<p>Verify that the <code>PowerManager.Service.Display</code> wakelock disappears (<code>adb shell dumpsys power | grep "Display"</code>).</p>
</li>
<li>
<p><strong>Clear the SuspendLockout wakelock</strong>  </p>
</li>
<li>Check for the ‚ÄúStay awake while charging‚Äù developer option:<br />
<code>bash
     adb shell settings get global stay_on_while_plugged_in</code><br />
     If the value is non‚Äëzero, clear it:<br />
<code>bash
     adb shell settings put global stay_on_while_plugged_in 0</code></li>
<li>
<p>Look for other system settings that may request a suspend lockout (e.g., ‚ÄúNever sleep‚Äù in battery‚Äëoptimization UI).  </p>
</li>
<li>
<p><strong>Confirm suspend can now be entered</strong>  </p>
</li>
<li>Run a manual suspend test:<br />
<code>bash
     adb shell dumpsys suspend_control_internal</code></li>
<li>Or trigger a suspend via:<br />
<code>bash
     adb shell echo mem &gt; /sys/power/state</code></li>
<li>
<p>After the screen is off and the lockout cleared, you should see <code>suspend attempts</code> increase and <code>success</code> counters in <code>/d/suspend_stats</code>.</p>
</li>
<li>
<p><strong>If the lockout persists after the above steps</strong>  </p>
</li>
<li>Identify the component that is programmatically acquiring <code>PowerManager.SuspendLockout</code> (e.g., a custom ROM feature, background service, or a buggy driver).  </li>
<li>Use <code>adb shell dumpsys power | grep "SuspendLockout"</code> to see the stack trace or caller.  </li>
<li>
<p>Update/disable the offending component, or file a bug report with the OEM.</p>
</li>
<li>
<p><strong>General power‚Äëoptimisation checklist</strong>  </p>
</li>
<li>Disable ‚ÄúAlways‚ÄëOn Display‚Äù or ‚ÄúAmbient Display‚Äù.  </li>
<li>Ensure no app is holding a <em>partial</em> wake lock (<code>adb shell dumpsys power | grep "WakeLock"</code>).  </li>
<li>Verify battery‚Äëoptimisation is enabled for all third‚Äëparty apps (<code>Settings ‚Üí Battery ‚Üí Battery optimisation</code>).  </li>
</ol>
<p>Once the display is off and the suspend lockout cleared, the kernel will be able to enter suspend, and the counters in <code>/d/suspend_stats</code> will start reflecting successful suspend cycles.</p>
<hr />
<h2>üìÅ Evidence Files</h2>
<ul>
<li><strong>dumpsys_suspend.txt</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\suspend\blocked_bywakelock\dumpsys_suspend.txt</code></li>
</ul>
<hr />
<h2>‚úÖ Verification Checklist</h2>
<p>After fixing the identified issue:</p>
<ol>
<li><strong>Re-run diagnosis</strong>: Collect new evidence and verify the issue is resolved</li>
<li><strong>Check suspend_stats</strong>: Verify success count increases and fail count remains 0</li>
<li><strong>Check wakelocks</strong>: Ensure no active wakelocks in dumpsys output</li>
<li><strong>Measure power</strong>: Compare power consumption before/after fix (expect ‚â•3% reduction)</li>
</ol>
    </div>
</body>
</html>