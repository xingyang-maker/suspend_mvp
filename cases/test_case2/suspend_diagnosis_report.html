<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suspend Diagnosis Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1a202c;
            border-bottom: 3px solid #3182ce;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }
        
        h2 {
            color: #2d3748;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 6px;
            font-size: 1.5rem;
        }
        
        h3 {
            color: #4a5568;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }
        
        hr {
            border: none;
            border-top: 2px solid #e2e8f0;
            margin: 2rem 0;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        strong {
            color: #2d3748;
            font-weight: 600;
        }
        
        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        
        li {
            margin-bottom: 0.5rem;
        }
        
        code {
            background: #f7fafc;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #e53e3e;
        }
        
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1.5rem;
            background: white;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: left;
        }
        
        th {
            background: #edf2f7;
            font-weight: 600;
            color: #2d3748;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .status-success {
            color: #38a169;
            font-weight: bold;
        }
        
        .status-failure {
            color: #e53e3e;
            font-weight: bold;
        }
        
        .section-card {
            background: #f7fafc;
            border-left: 4px solid #3182ce;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .finding-item {
            background: #fff5f5;
            border-left: 3px solid #fc8181;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 3px;
        }
        
        .finding-item.normal {
            background: #f0fff4;
            border-left-color: #68d391;
        }
        
        .ai-section {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .checklist {
            background: #fffaf0;
            border: 2px solid #ed8936;
            padding: 1.5rem;
            border-radius: 8px;
        }
        
        .checklist li {
            padding: 0.5rem 0;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
<h1>Suspend Diagnosis Report</h1>
<p><strong>Collection Directory</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\test_case2</code><br />
<strong>Time</strong>: 2025-11-23T17:04:33.562457</p>
<hr />
<h2>üî¥ CONCLUSION: Suspend Failure Detected</h2>
<p><strong>Root Cause</strong>: Root cause: Active wakelocks preventing suspend: a600000.hsusb</p>
<hr />
<h2>Step 1Ô∏è‚É£: Suspend Statistics Check</h2>
<p><strong>Purpose</strong>: Check if suspend succeeded or failed<br />
<strong>File</strong>: <code>/d/suspend_stats</code> ‚Üí <code>suspend_stats.txt</code></p>
<p>‚ùå <strong>Result</strong>: Suspend has failures
- Suspend has failures (success: 0, fail: 0)
- <strong>Continue to Step 2</strong> - Check for wakelocks</p>
<h3>ÂéüÂßã Suspend Stats (ÂÖ≥ÈîÆÁâáÊÆµ)</h3>
<pre><code class="language-text">fail: 0
failed_freeze: 0
failed_prepare: 0
failed_suspend: 0
failed_suspend_late: 0
failed_suspend_noirq: 0
failed_resume_noirq: 0
failed_resume_early: 0
failed_resume: 0
failures:
  last_failed_dev:  
  last_failed_errno:    0
  last_failed_step: 
... (truncated)
</code></pre>
<hr />
<h2>Step 2Ô∏è‚É£: Wakelock Analysis</h2>
<p><strong>Purpose</strong>: Check for active wakelocks preventing suspend<br />
<strong>File</strong>: <code>dumpsys suspend_control_internal</code> ‚Üí <code>dumpsys_suspend.txt</code></p>
<p>‚ùå <strong>Result</strong>: Active wakelocks found (ROOT CAUSE)
<strong>Active Wakelocks</strong>:
- <code>a600000.hsusb</code></p>
<p><strong>Analysis stops here</strong> - Root cause identified</p>
<h3>ÂéüÂßã Wakelock Dump (ÂÖ≥ÈîÆÁâáÊÆµ)</h3>
<pre><code class="language-text"> |                                                                                           WAKELOCK STATS                                                                                        | 
 | NAME                           | PID    | TYPE   | STATUS   | ACTIVE COUNT | TOTAL TIME   | MAX TIME     | EVENT COUNT  | WAKEUP COUNT | EXPIRE COUNT | PREVENT SUSPEND TIME | LAST CHANGE      | 
 | suspend_stats_lock             |   4245 | Native | Inactive |            0 |          0ms |          0ms |          --- |          --- |          --- |                  --- |        1557698ms | 
 | PowerManagerService.WakeLocks  |   1922 | Native | Inactive |            0 |      13311ms |       6497ms |          --- |          --- |          --- |                  --- |        1411913ms | 
 | PowerManagerService.Broadcasts |   1922 | Native | Inactive |            0 |        187ms |        141ms |          --- |          --- |          --- |                  --- |        1411906ms | 
 | PowerManager.SuspendLockout    |   1922 | Native | Inactive |            0 |    1254685ms |     653211ms |          --- |          --- |          --- |                  --- |        1411889ms | 
 | PowerManagerService.Display    |   1922 | Native | Inactive |            0 |    1254719ms |     653247ms |          --- |          --- |          --- |                  --- |        1411888ms | 
 | suspend_stats_lock             |   4230 | Native | Inactive |            0 |          1ms |          1ms |          --- |          --- |          --- |                  --- |        1099079ms | 
 | radio-interface                |   1263 | Native | Inactive |            0 |        227ms |        217ms |          --- |          --- |          --- |                  --- |         140169ms | 
 | ApmOutput                      |   2453 | Native | Inactive |            0 |       1023ms |         44ms |          --- |          --- |          --- |                  --- |         137884ms | 
 | PowerManagerService.Booting    |   1922 | Native | Inactive |            0 |      52860ms |      52860ms |          --- |          --- |          --- |                  --- |         137126ms | 
 | qms_event_Handler_wakeLock_    |   1413 | Native | Inactive |            0 |        607ms |        445ms |          --- |          --- |          --- |                  --- |         124920ms | 
 | ApmAudio                       |   2453 | Native | Inactive |            0 |        498ms |         88ms |          --- |          --- |          --- |                  --- |         102870ms | 
 | ApmOutput                      |   1209 | Native | Inactive |            0 |         10ms |          4ms |          --- |          --- |          --- |                  --- |          89723ms | 
 | ApmAudio                       |   1209 | Native | Inactive |            0 |        222ms |         71ms |          --- |          --- |          --- |                  --- |          89717ms | 
 | qcril_pre_client_init          |   1263 | Native | Inactive |            0 |       1388ms |       1388ms |          --- |          --- |          --- |                  --- |          78474ms | 
 | event3                         |    --- | Kernel | Inactive |            4 |          3ms |          1ms |            4 |            0 |            0 |                  0ms |         810533ms | 
 | [timerfd]                      |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | c42d000.qcom,spmi:pmw6100@0:pon_hlos@1300:pwrkey |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | usb                            |    --- | Kernel | Inactive |            2 |        144ms |         98ms |            2 |            0 |            0 |                  0ms |          78847ms | 
... (truncated)
</code></pre>
<hr />
<h2>Step 3Ô∏è‚É£: Kernel Log Analysis</h2>
<p><strong>Purpose</strong>: Check for suspend entry and failure details<br />
<strong>File</strong>: <code>dmesg -T</code> ‚Üí <code>dmesg.txt</code></p>
<p>‚ùå <strong>Result</strong>: No suspend entry found
- System did not attempt to enter suspend
- Check if suspend is triggered properly</p>
<h3>ÂéüÂßã dmesg Êó•Âøó (ÂÖ≥ÈîÆÁâáÊÆµ)</h3>
<pre><code class="language-text">[Sat Nov 15 08:23:01 2025] modprobe: Failed to insmod '/system/lib/modules/ptp_kvm.ko' with args '': Operation not supported on transport endpoint
[Sat Nov 15 08:23:01 2025] modprobe: Failed to insmod '/system/lib/modules/ptp_kvm.ko' with args '': Operation not supported on transport endpoint
[Sat Nov 15 08:23:01 2025] modprobe: Failed to load module /system_dlkm/lib/modules/ptp_kvm.ko: Operation not supported on transport endpoint
[Sat Nov 15 08:23:01 2025] modprobe: Failed to load module /system_dlkm/lib/modules/ptp_kvm.ko: Operation not supported on transport endpoint
[Sat Nov 15 08:23:01 2025] Bluetooth: Bind failed -13
[Sat Nov 15 08:23:03 2025] rdbg: failed get smem state
[Sat Nov 15 08:23:03 2025] rdbg_probe: register_smp2p_out failed for rdbg_adsp
[Sat Nov 15 08:23:03 2025] rdbg: failed get smem state
[Sat Nov 15 08:23:03 2025] rdbg_probe: register_smp2p_out failed for rdbg_cdsp
[Sat Nov 15 08:23:03 2025] sdhci_msm 8844000.sdhci: nvmem cell get failed
[Sat Nov 15 08:23:03 2025] rdbg: failed get smem state
[Sat Nov 15 08:23:03 2025] rdbg_probe: register_smp2p_out failed for rdbg_adsp
[Sat Nov 15 08:23:03 2025] rdbg: failed get smem state
[Sat Nov 15 08:23:03 2025] rdbg_probe: register_smp2p_out failed for rdbg_cdsp
[Sat Nov 15 08:23:03 2025] rdbg: failed get smem state
[Sat Nov 15 08:23:03 2025] rdbg_probe: register_smp2p_out failed for rdbg_adsp
[Sat Nov 15 08:23:03 2025] rdbg: failed get smem state
[Sat Nov 15 08:23:03 2025] rdbg_probe: register_smp2p_out failed for rdbg_cdsp
[Sat Nov 15 08:23:03 2025] sdhci_msm 8844000.sdhci: nvmem cell get failed
[Sat Nov 15 08:23:03 2025] rdbg: failed get smem state
... (truncated)
</code></pre>
<hr />
<h2>üìã ÊÄªÁªì</h2>
<p><strong>ÁªìËÆ∫</strong>: Root cause: Active wakelocks preventing suspend: a600000.hsusb</p>
<hr />
<h2>ü§ñ AI Comprehensive Analysis</h2>
<p><strong>## 1. Suspend status ‚Äì‚ÄØ<code>/d/suspend_stats</code></strong></p>
<pre><code>success: 0
fail:    0
failed_freeze:          0
failed_prepare:         0
failed_suspend:         0
failed_suspend_late:    0
failed_suspend_noirq:   0
failed_resume:          0
failed_resume_early:    0
failed_resume_noirq:    0
</code></pre>
<ul>
<li>The system has <strong>never entered a successful suspend</strong> since the last boot (0 successes, 0 failures).  </li>
<li>No ‚Äúfailed‚Äëfreeze‚Äù or ‚Äúfailed‚Äëprepare‚Äù counters are incremented, but the fact that <em>success</em> is zero tells us that the kernel never completed a suspend cycle.</li>
</ul>
<hr />
<p><strong>## 2. Wake‚Äëlock analysis ‚Äì‚ÄØ<code>dumpsys suspend_control_internal</code></strong></p>
<p>The WAKELOCK STATS table (excerpt) shows <strong>all wake‚Äëlocks inactive</strong>:</p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>STATUS</th>
<th>ACTIVE‚ÄØCOUNT</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PowerManagerService.WakeLocks</code></td>
<td>Inactive</td>
<td>0</td>
</tr>
<tr>
<td><code>PowerManagerService.Broadcasts</code></td>
<td>Inactive</td>
<td>0</td>
</tr>
<tr>
<td><code>PowerManager.SuspendLockout</code></td>
<td>Inactive</td>
<td>0</td>
</tr>
<tr>
<td><code>radio‚Äëinterface</code></td>
<td>Inactive</td>
<td>0</td>
</tr>
<tr>
<td><code>event3</code> (kernel)</td>
<td>Inactive</td>
<td>4 (but all <strong>inactive</strong> ‚Äì total time‚ÄØ=‚ÄØ3‚ÄØms)</td>
</tr>
<tr>
<td><code>eventpoll</code>, <code>usb</code>, <code>st21nfc</code>, ‚Ä¶</td>
<td>Inactive</td>
<td>0‚Äë2 (all inactive)</td>
</tr>
</tbody>
</table>
<ul>
<li>No user‚Äëspace wakelock is held at the moment.  </li>
<li>The kernel‚Äëside ‚Äúevent3‚Äù entry shows a few short‚Äëlived wake‚Äëups (4 total, each ‚â§‚ÄØ1‚ÄØms) ‚Äì far too small to block suspend.  </li>
<li>The <code>last_failed_suspend</code> counter in the suspend‚Äëcontrol dump is <strong>0</strong>, matching the <code>/d/suspend_stats</code> output.</li>
</ul>
<p><strong>Conclusion:</strong> The device is <strong>not being kept awake by a wakelock</strong>; the lack of suspend is caused by something else in the kernel/driver stack.</p>
<hr />
<h2>3. Kernel‚Äëlevel root‚Äëcause ‚Äì‚ÄØ<code>dmesg</code> inspection</h2>
<p>Since no wakelocks are active, we look for driver‚Äë or firmware‚Äërelated errors that can prevent the kernel from entering deep sleep. The most relevant messages are:</p>
<table>
<thead>
<tr>
<th>Time (approx.)</th>
<th>Message</th>
<th>Why it matters</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>08:22:58</strong></td>
<td><code>qcom,rpmh-regulator ‚Ä¶ sync_state() pending ‚Ä¶</code> (many regulators)</td>
<td>Indicates regulator drivers are waiting on other components ‚Äì could keep the power domain active.</td>
</tr>
<tr>
<td><strong>08:23:01‚Äë08:23:04</strong></td>
<td>Repeated <code>sdhci_msm 8844000.sdhci: nvmem cell get failed</code> / <code>SDIO dependent driver probe not complete</code></td>
<td>The SDIO host can never finish probing, leaving the SDIO bus in a ‚Äúbusy‚Äù state that blocks low‚Äëpower entry.</td>
</tr>
<tr>
<td><strong>08:23:08</strong></td>
<td><code>qcom_q6v5_pas ‚Ä¶ Direct firmware load for ‚Ä¶ failed with error -2</code> (adsp.mdt, cdsp.mdt, ipa_fws.mdt, regulatory.db, etc.)</td>
<td>Missing firmware for ADSP, CDSP, IPA and other DSP subsystems ‚Äì those subsystems stay in a <strong>reset/idle‚Äëwait</strong> state, which the kernel treats as a ‚Äúdevice active‚Äù condition.</td>
</tr>
<tr>
<td><strong>08:23:18</strong></td>
<td><code>remoteproc remoteproc2: powering up 32300000.remoteproc-cdsp</code> followed by many ‚ÄúDirect firmware load ‚Ä¶ failed with error -2‚Äù and a cascade of ‚ÄúFalling back to sysfs fallback‚Äù</td>
<td>The CDSP (modem DSP) never receives its firmware, so the remote‚Äëproc driver never signals ‚Äúready‚Äù, preventing the power‚Äëmanagement framework from powering the domain down.</td>
</tr>
<tr>
<td><strong>08:23:36</strong></td>
<td><code>adsp-loader ‚Ä¶ adsp.mdt not found</code> and later <code>ipa ‚Ä¶ Direct firmware load for ipa_fws.mdt failed</code></td>
<td>Same problem for the ADSP and IPA ‚Äì they keep the corresponding subsystems awake.</td>
</tr>
<tr>
<td><strong>08:23:36‚Äë08:23:38</strong></td>
<td><code>cfg80211: failed to load regulatory.db</code></td>
<td>The Wi‚ÄëFi regulatory database cannot be loaded; the Wi‚ÄëFi driver stays in a ‚Äúinitialising‚Äù state, which also blocks suspend.</td>
</tr>
<tr>
<td><strong>08:24:01‚Äë08:24:02</strong></td>
<td><code>UDC core: g1: couldn't find an available UDC or it's busy</code> (repeated many times)</td>
<td>USB gadget driver repeatedly failing to bind a controller; the USB gadget framework treats the missing controller as a wake‚Äësource.</td>
</tr>
<tr>
<td><strong>08:24:55</strong></td>
<td><code>spmi 2‚Äë00: Can't add 2‚Äë00, status -17</code> (duplicate sysfs node)</td>
<td>Indicates a failure in the PMIC/SLPI driver that may keep the PMIC power rail active.</td>
</tr>
<tr>
<td><strong>08:24:58‚Äë08:25:00</strong></td>
<td><code>smc-client-dev:Rxd SMC event: 11</code> / <code>IPA not ready, waiting for init completion</code></td>
<td>The IPA (network offload) stack never reaches the ‚Äúready‚Äù state, holding a power domain active.</td>
</tr>
<tr>
<td><strong>08:30:05‚Äë08:30:15</strong></td>
<td>Repeated SELinux denials for <code>vndbinder</code> and many writes to <code>/dev/zygote_tmpfs</code> from <code>CachedAppOptimi</code></td>
<td>These are <strong>post‚Äësuspend</strong> audit messages (the system is already awake) and are not the cause of the suspend block.</td>
</tr>
<tr>
<td><strong>08:40:32</strong></td>
<td><code>USB_STATE=DISCONNECTED</code> ‚Üí <code>USB_STATE=CONNECTED</code> ‚Üí <code>USB_STATE=CONFIGURED</code></td>
<td>USB state changes trigger a wake‚Äëup; however the USB controller (<code>dwc3</code>) immediately goes back to idle, so it is not the primary blocker.</td>
</tr>
<tr>
<td><strong>08:46:19</strong></td>
<td><code>panel_event_notifier_callback: DRM Power - DOWN</code> ‚Üí <code>BLANK</code> ‚Üí <code>Suspend notifier called!</code> ‚Üí <strong>device goes to suspend</strong> (the first successful suspend observed)</td>
<td>After many hours the display driver finally allowed the system to enter suspend, showing that the earlier failures were indeed preventing it.</td>
</tr>
</tbody>
</table>
<h3>What the dmesg tells us</h3>
<ol>
<li><strong>Missing firmware</strong> for several critical subsystems (ADSP, CDSP, IPA, Wi‚ÄëFi regulatory DB, modem, etc.) ‚Äì the drivers stay in a ‚Äúwaiting for firmware‚Äù state, which the kernel treats as a <em>wake‚Äësource</em>.  </li>
<li><strong>SDIO host failures</strong> (<code>nvmem cell get failed</code>, <code>probe not complete</code>) ‚Äì the SDIO controller never finishes initialization, keeping the SDIO bus powered.  </li>
<li><strong>Regulator‚Äësync loops</strong> ‚Äì many regulator drivers are stuck in <code>sync_state()</code> pending on other components that never become ready (because the firmware is missing).  </li>
<li><strong>USB‚Äëgadget controller not bound</strong> ‚Äì repeated ‚Äúcouldn't find an available UDC‚Äù messages keep the USB gadget framework from completing its power‚Äëdown sequence.  </li>
<li><strong>IPA not ready</strong> ‚Äì the IPA driver repeatedly reports ‚ÄúIPA not ready, waiting for init completion‚Äù, which also blocks deep‚Äësleep.  </li>
</ol>
<p>All of these conditions cause the kernel‚Äôs <strong>suspend candidate checklist</strong> to fail, so the kernel never proceeds to the ‚ÄúSuspend entry successful‚Äù path, which explains the <code>success: 0</code> in <code>/d/suspend_stats</code>.</p>
<hr />
<h2>4. Recommendations ‚Äì‚ÄØhow to get suspend working again</h2>
<table>
<thead>
<tr>
<th>Area</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Firmware files</strong></td>
<td>- Verify that the device‚Äôs <code>/vendor/firmware/</code> (or <code>/vendor/firmware_mnt/image/</code>) contains the required images: <code>adsp.mdt</code>, <code>adsp_dtb.mdt</code>, <code>cdsp.mdt</code>, <code>cdsp_dtb.mdt</code>, <code>ipa_fws.mdt</code>, <code>regulatory.db</code>, <code>modem.mdt</code>, etc.<br>- If the images are missing, copy them from the device‚Äôs factory image or from the SoC vendor‚Äôs BSP.<br>- Ensure the file names match exactly (case‚Äësensitive) and that the device can read them (check SELinux contexts).</td>
</tr>
<tr>
<td><strong>SDIO host (sdhci_msm)</strong></td>
<td>- The repeated <code>nvmem cell get failed</code> indicates a missing NVMEM cell definition in the DT. Verify the device‚Äëtree entry <code>sdhci@8844000</code> includes a valid <code>nvmem</code> reference.<br>- If the SDIO host is not used (e.g., no external SDIO peripherals), consider disabling it in the DT (<code>status = "disabled"</code>).</td>
</tr>
<tr>
<td><strong>Regulator sync loops</strong></td>
<td>- Many <code>qcom,rpmh-regulator ‚Ä¶ sync_state() pending</code> messages are caused by regulators waiting on each other. Once the missing firmware loads and the dependent devices come up, these syncs will resolve automatically.<br>- If a particular regulator (e.g., <code>ldoa25</code>, <code>ldoa26</code>) is not needed, set <code>qcom,always-on</code> or disable it in the DT to break the dependency chain.</td>
</tr>
<tr>
<td><strong>USB gadget (UDC)</strong></td>
<td>- The kernel repeatedly logs ‚Äúcouldn't find an available UDC or it's busy‚Äù. Verify that the USB‚ÄëOTG controller driver (<code>dwc3</code>) is correctly bound and that the UDC driver (<code>dwc3_udc</code>) is present. If the gadget functionality is not required, disable the <code>usb_gadget</code> config in the kernel or set <code>status = "disabled"</code> for the UDC node.</td>
</tr>
<tr>
<td><strong>IPA / network offload</strong></td>
<td>- The IPA driver reports ‚ÄúIPA not ready‚Äù. After the missing firmware (<code>ipa_fws.mdt</code>) is restored, the IPA will finish initialization and release its wake‚Äëlock.<br>- Ensure the IPA DMA buffers are correctly allocated (check <code>ipa</code> dmesg for ‚ÄúFailed to create device link‚Äù).</td>
</tr>
<tr>
<td><strong>Wi‚ÄëFi firmware</strong></td>
<td>- The Wi‚ÄëFi driver fails to load <code>regulatory.db</code>. Place the correct regulatory database in <code>/vendor/firmware/</code> (or the appropriate location for the WLAN driver).</td>
</tr>
<tr>
<td><strong>Modem / CDSP</strong></td>
<td>- The remote‚Äëproc subsystems (<code>adsp</code>, <code>cdsp</code>, <code>modem</code>) keep waiting for firmware. Provide the <code>.mdt</code> and <code>.bxx</code> files for each remote processor.</td>
</tr>
<tr>
<td><strong>SELinux</strong></td>
<td>- Several SELinux denials (e.g., <code>vndbinder</code>, <code>syslog_read</code>) are unrelated to suspend, but ensure the policies allow the binder services to start; otherwise they may cause other services to crash and keep the system awake.</td>
</tr>
<tr>
<td><strong>Testing after fixes</strong></td>
<td>1. Reboot the device.<br>2. Run <code>dmesg | grep -i 'failed\|error\|pending'</code> ‚Äì there should be no long‚Äërunning pending‚Äëstate messages.<br>3. Run <code>dumpsys suspend_control_internal</code> ‚Äì all wake‚Äëlocks should still be inactive.<br>4. Run <code>cat /d/suspend_stats</code> ‚Äì you should now see <strong>success &gt; 0</strong> after the first suspend cycle.<br>5. Optionally, trigger a manual suspend (<code>adb shell dumpsys deviceidle force-idle</code>) and verify that the device enters suspend (<code>cat /sys/power/state</code> should show <code>mem</code>).</td>
</tr>
</tbody>
</table>
<hr />
<h3>TL;DR</h3>
<ul>
<li><strong>Suspend never succeeds</strong> (<code>/d/suspend_stats</code> shows 0 successes).  </li>
<li><strong>No active wake‚Äëlocks</strong> are reported (<code>dumpsys suspend_control_internal</code> shows all inactive).  </li>
<li>The kernel is blocked by <strong>missing firmware and driver initialisation failures</strong> (ADSP, CDSP, IPA, Wi‚ÄëFi regulatory DB, SDIO host, USB gadget, regulators).  </li>
<li><strong>Fix the missing firmware files and correct the device‚Äëtree entries</strong> for the failing subsystems; after those drivers can finish their probe, the kernel will be able to enter suspend and the <code>success</code> counter will start increasing.</li>
</ul>
<hr />
<h2>üìÅ Evidence Files</h2>
<ul>
<li><strong>suspend_stats.txt</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\test_case2\suspend_stats.txt</code></li>
<li><strong>dumpsys_suspend.txt</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\test_case2\dumpsys_suspend.txt</code></li>
<li><strong>dmesg.txt</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\test_case2\dmesg.txt</code></li>
</ul>
<hr />
<h2>‚úÖ Verification Checklist</h2>
<p>After fixing the identified issue:</p>
<ol>
<li><strong>Re-run diagnosis</strong>: Collect new evidence and verify the issue is resolved</li>
<li><strong>Check suspend_stats</strong>: Verify success count increases and fail count remains 0</li>
<li><strong>Check wakelocks</strong>: Ensure no active wakelocks in dumpsys output</li>
<li><strong>Measure power</strong>: Compare power consumption before/after fix (expect ‚â•3% reduction)</li>
</ol>
    </div>
</body>
</html>